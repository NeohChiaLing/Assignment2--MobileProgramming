<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sleep & Data App</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #03174C;
            --card-bg: #1F2E5B;
            --accent: #8E97FD;
            --text-primary: #ffffff;
            --text-secondary: #A0A3B1;
            --nav-bg: #03174C;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-primary);
            font-family: 'Nunito', sans-serif;

            /* FIX: Increased top padding to 100px to clear the header */
            padding-top: 100px;
            padding-bottom: 110px;
        }

        /* --- Sections --- */
        .api-section { display: none; animation: fadeIn 0.4s ease-in-out; }
        .active-section { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* --- Cards --- */
        .card {
            background-color: var(--card-bg);
            border: none;
            border-radius: 20px;
            color: white;
            margin-bottom: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        /* --- Buttons --- */
        .btn-primary {
            background-color: var(--accent);
            border: none;
            border-radius: 25px;
            padding: 12px;
            font-weight: bold;
            width: 100%;
            box-shadow: 0 4px 10px rgba(142, 151, 253, 0.3);
        }
        .btn-outline-light { border-radius: 20px; padding: 8px 20px; }

        /* --- Bottom Navigation --- */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--nav-bg);
            padding: 15px 10px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            border-top: 1px solid rgba(255,255,255,0.1);
            z-index: 1000;
        }
        .nav-item {
            text-align: center;
            color: var(--text-secondary);
            font-size: 11px;
            cursor: pointer;
            transition: 0.3s;
            flex: 1;
        }
        .nav-item.active { color: var(--accent); transform: translateY(-2px); }
        .nav-icon { font-size: 22px; display: block; margin-bottom: 5px; }

        /* --- Offcanvas (Menu Drawer) --- */
        .offcanvas { background-color: var(--card-bg); color: white; border-top-left-radius: 25px; border-top-right-radius: 25px; }
        .offcanvas-header { border-bottom: 1px solid rgba(255,255,255,0.1); }
        .btn-close { filter: invert(1); }
        .list-group-item { background: transparent; border: none; color: white; border-bottom: 1px solid rgba(255,255,255,0.05); padding: 15px; }
    </style>
</head>
<body>

<div class="container">

    <div id="movies" class="api-section active-section">
        <div class="mb-4">
            <h1 class="display-6 fw-bold">Movie Night</h1>
            <p class="text-secondary">Studio Ghibli Collection</p>
        </div>

        <div id="movieResult">
            <div class="card p-5 text-center">
                <div class="spinner-border text-light" role="status"></div>
                <p class="mt-3 text-secondary">Loading movie...</p>
            </div>
        </div>

        <button class="btn btn-primary mt-3" onclick="fetchMovie()">Shuffle Movie</button>
    </div>


    <div id="food" class="api-section">
        <div class="d-flex justify-content-between align-items-center mb-4 pt-3">
            <h2 class="fw-bold m-0">Relaxing Meals</h2>
            <button class="btn btn-outline-light btn-sm" onclick="fetchMeal()">+ New Meal</button>
        </div>

        <div id="mealResult">
        </div>
    </div>


    <div id="products" class="api-section">
        <div class="d-flex justify-content-between align-items-center mb-4 pt-3">
            <h2 class="fw-bold m-0">Shop</h2>
            <button class="btn btn-sm btn-primary" style="width: auto;" onclick="fetchProducts()">Refresh Cart</button>
        </div>

        <div id="productResult">
            <div class="card p-4 text-center"><p class="text-secondary">Cart is empty</p></div>
        </div>
    </div>


    <div id="logs" class="api-section">
        <h2 class="mb-4 pt-3 fw-bold">Activity History</h2>
        <button class="btn btn-danger btn-sm mb-3 w-100" onclick="clearLogs()">Clear All Logs</button>

        <div class="card p-0">
            <div class="table-responsive">
                <table class="table table-dark table-borderless mb-0" style="background: transparent;">
                    <thead style="border-bottom: 1px solid rgba(255,255,255,0.1);">
                    <tr class="text-secondary">
                        <th class="p-3">API Source</th>
                        <th class="p-3">Action Details</th>
                    </tr>
                    </thead>
                    <tbody id="logTableBody"></tbody>
                </table>
            </div>
        </div>
    </div>

</div>

<div class="bottom-nav">
    <div class="nav-item active" onclick="showSection('movies', this)">
        <span class="nav-icon">üé¨</span> Movie
    </div>
    <div class="nav-item" onclick="showSection('food', this)">
        <span class="nav-icon">üåô</span> Food
    </div>
    <div class="nav-item" onclick="showSection('products', this)">
        <span class="nav-icon">üéµ</span> Shop
    </div>
    <div class="nav-item" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu">
        <span class="nav-icon">üë§</span> Menu
    </div>
</div>

<div class="offcanvas offcanvas-bottom" tabindex="-1" id="offcanvasMenu" style="height: 60%;">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title">Profile & Settings</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas"></button>
    </div>
    <div class="offcanvas-body">
        <div class="list-group list-group-flush">
            <a href="#" class="list-group-item" onclick="showSection('logs', null)">
                üìú View Interaction Logs
            </a>
            <a href="#" class="list-group-item">
                ‚öôÔ∏è App Settings
            </a>
            <a href="#" class="list-group-item">
                ‚ÑπÔ∏è About DataHub
            </a>
        </div>

        <div class="mt-4 p-3 rounded" style="background: rgba(255,255,255,0.05);">
            <p class="mb-1 text-accent small text-uppercase">Student Profile</p>
            <h6 class="mb-0">Neoh Chia Ling</h6>
            <small class="text-secondary">ID: 299232</small>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // --- 1. SETUP ---
    window.onload = function() {
        fetchMovie(); // Load content on start
    };

    function showSection(id, element) {
        document.querySelectorAll('.api-section').forEach(el => el.classList.remove('active-section'));
        document.getElementById(id).classList.add('active-section');

        if(element) {
            document.querySelectorAll('.nav-item').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
        }

        if(id === 'logs') {
            renderLogs();
            const offcanvasEl = document.getElementById('offcanvasMenu');
            const offcanvas = bootstrap.Offcanvas.getInstance(offcanvasEl);
            if(offcanvas) offcanvas.hide();
        }
    }

    function logInteraction(api, action) {
        const logs = JSON.parse(localStorage.getItem('appLogs')) || [];
        logs.unshift({ api, action });
        localStorage.setItem('appLogs', JSON.stringify(logs));
    }

    // --- 2. MOVIE API ---
    async function fetchMovie() {
        try {
            const res = await fetch('https://ghibliapi.vercel.app/films');
            const data = await res.json();
            const movie = data[Math.floor(Math.random() * data.length)];

            const html = `
                <div class="card mb-3 border-0" style="background: url('${movie.movie_banner}') center/cover; height: 350px; position: relative;">
                    <div style="position: absolute; bottom:0; left:0; width:100%; background: linear-gradient(to top, #03174C, transparent); padding: 25px;">
                        <h2 class="text-white mb-1">${movie.title}</h2>
                        <div class="d-flex gap-2">
                            <span class="badge bg-primary">${movie.running_time} min</span>
                            <span class="badge bg-success">Score: ${movie.rt_score}</span>
                        </div>
                    </div>
                </div>
                <div class="p-2">
                    <p class="text-secondary" style="font-size: 15px; line-height: 1.6;">${movie.description}</p>
                </div>
            `;
            document.getElementById('movieResult').innerHTML = html;
            logInteraction('Movie API', `Viewed ${movie.title}`);
        } catch (e) { console.log(e); }
    }

    // --- 3. FOOD API ---
    async function fetchMeal() {
        try {
            const res = await fetch('https://www.themealdb.com/api/json/v1/1/random.php');
            const data = await res.json();
            const meal = data.meals[0];

            const html = `
                <div class="card">
                    <img src="${meal.strMealThumb}" class="card-img-top" alt="Meal" style="height: 200px; object-fit: cover;">
                    <div class="card-body">
                        <h5 class="card-title">${meal.strMeal}</h5>
                        <p class="small text-secondary mb-3">${meal.strCategory} | ${meal.strArea}</p>
                        <a href="${meal.strYoutube}" class="btn btn-primary btn-sm">Watch Video Recipe</a>
                    </div>
                </div>
            `;
            document.getElementById('mealResult').innerHTML = html;
            logInteraction('Food API', `Viewed ${meal.strMeal}`);
        } catch (e) { alert("Failed to load meal"); }
    }

    // --- 4. PRODUCT API ---
    async function fetchProducts() {
        try {
            const res = await fetch('https://fakestoreapi.com/products?limit=10');
            const all = await res.json();
            const cart = all.sort(() => 0.5 - Math.random()).slice(0, 3);

            let total = 0;
            let listHtml = '';

            cart.forEach(item => {
                const priceRM = item.price * 4.5;
                total += priceRM;
                listHtml += `
                    <div class="d-flex align-items-center mb-3 pb-3" style="border-bottom:1px solid rgba(255,255,255,0.05)">
                        <img src="${item.image}" style="width:50px; height:50px; object-fit:contain; background:white; border-radius:8px; padding:2px;" class="me-3">
                        <div class="flex-grow-1">
                            <h6 class="mb-0 text-truncate" style="max-width: 180px; font-size:14px;">${item.title}</h6>
                            <small class="text-accent">RM ${priceRM.toFixed(2)}</small>
                        </div>
                    </div>
                `;
            });

            let msg = total > 150 ? '‚úÖ Free Shipping Applied' : '‚ö†Ô∏è Shipping: +RM15.00';
            let totalDisplay = total > 150 ? total : total + 15;

            const summaryHtml = `
                <div class="card p-3">
                    ${listHtml}
                    <div class="mt-2 pt-2">
                        <div class="d-flex justify-content-between align-items-center">
                            <span class="text-secondary small">Total (inc. shipping)</span>
                            <h3 class="mb-0">RM ${totalDisplay.toFixed(2)}</h3>
                        </div>
                        <div class="mt-2 small" style="color: ${total > 150 ? '#4CAF50' : '#FFC107'};">${msg}</div>
                    </div>
                </div>
            `;

            document.getElementById('productResult').innerHTML = summaryHtml;
            logInteraction('Product API', `Cart Total: RM ${totalDisplay.toFixed(2)}`);

        } catch (e) { console.log(e); }
    }

    // --- 5. LOGS ---
    function renderLogs() {
        const logs = JSON.parse(localStorage.getItem('appLogs')) || [];
        const tbody = document.getElementById('logTableBody');
        tbody.innerHTML = '';
        logs.slice(0, 15).forEach(log => {
            tbody.innerHTML += `
                <tr>
                    <td class="p-3"><span class="badge bg-secondary">${log.api}</span></td>
                    <td class="p-3 small text-secondary">${log.action}</td>
                </tr>
            `;
        });
    }
    function clearLogs() { localStorage.removeItem('appLogs'); renderLogs(); }
</script>
</body>
</html>